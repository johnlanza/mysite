<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/images/favicon.png" type="image/png" />

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@400" />

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />

    <link
      href="https://fonts.cdnfonts.com/css/apple-garamond"
      rel="stylesheet" />

    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="/css/app.css" />
    <link
      href="https://cdn.quilljs.com/1.3.7/quill.snow.css"
      rel="stylesheet" />

    <title>John Lanza</title>

    <style>
      nav.simple-nav {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      nav.simple-nav a {
        margin-right: 20px;
        font-size: 1.1rem;
        text-decoration: none;
        color: var(--text-color);
        font-family: "Lexend", sans-serif;
      }

      nav.simple-nav a:visited {
        color: var(--text-color);
      }

      nav.simple-nav a:hover {
        text-decoration: underline;
      }

      /* ----- MOBILE STACKING ----- */
      @media (max-width: 600px) {
        nav.simple-nav {
          flex-direction: column;
          align-items: flex-start;
        }

        nav.simple-nav a {
          margin: 6px 0;
        }
      }
    </style>
  </head>

  <body class="d-flex flex-column vh-100">
    <div class="container mt-5 px-3">
      <div class="row align-items-center">
        <div class="col">
          <!-- SITE HEADER -->
          <div class="brand-row">
            <h1>
              <a href="/" class="main-header">John Lanza</a>
            </h1>
            <img
              src="/images/john-portrait.jpg"
              alt="Portrait of John Lanza"
              class="main-header-portrait"
              loading="lazy" />
          </div>

          <!-- SIMPLE TOP NAV (now responsive) -->
          <nav class="simple-nav">
            <a href="/books">Book Summaries</a>
            <a href="/events">Timeline</a>
            <a href="/#books-written">Writing</a>
            <a
              href="https://category6consulting.com/speaker/john-lanza/"
              target="_blank">
              Speaking
            </a>
            <a href="/games">Games</a>
            <a href="#" id="colors-link">Colors</a>
          </nav>

          <!-- FLASH MESSAGES -->
          <% if (success && success.length > 0) { %>
          <div
            class="alert alert-success alert-dismissible fade show"
            role="alert">
            <%= success %>
            <button type="button" class="close" data-dismiss="alert">
              <span>&times;</span>
            </button>
          </div>
          <% } %> <% if (error && error.length > 0) { %>
          <div
            class="alert alert-danger alert-dismissible fade show"
            role="alert">
            <%= error %>
            <button type="button" class="close" data-dismiss="alert">
              <span>&times;</span>
            </button>
          </div>
          <% } %> <%- body %>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script>
      (function () {
        const TOTAL_PALETTES = 4; // 0 = Warm (default), 1 = Seahawks, 2 = 70s, 3 = Dark
        const STORAGE_KEY = "sitePaletteIndex";
        const MODE_KEY = "sitePaletteMode"; // "auto" | "manual"
        const CYCLE = [0, 1, 2, 3, "auto"]; // auto step lets users get back to automatic mode
        const AUTO_CHECK_MS = 30 * 60 * 1000; // refresh auto choice every 30 minutes

        let currentPalette = 0;
        let currentMode = "auto";
        let cycleIndex = 0;
        let colorsLink = null;
        let autoTimerId = null;

        function applyPalette(index) {
          currentPalette = index;
          document.documentElement.setAttribute("data-palette", String(index));
          updateColorsLinkLabel();
        }

        function saveMode(mode) {
          try {
            localStorage.setItem(MODE_KEY, mode);
          } catch (e) {
            // ignore storage errors
          }
        }

        function savePalette(index) {
          try {
            localStorage.setItem(STORAGE_KEY, String(index));
          } catch (e) {
            // ignore storage errors
          }
        }

        function clearPalette() {
          try {
            localStorage.removeItem(STORAGE_KEY);
          } catch (e) {
            // ignore storage errors
          }
        }

        function getStoredSettings() {
          let mode = "auto";
          let palette = null;

          try {
            const storedMode = localStorage.getItem(MODE_KEY);
            if (storedMode === "manual") {
              mode = "manual";
            }

            const rawPalette = localStorage.getItem(STORAGE_KEY);
            const parsed = parseInt(rawPalette, 10);
            if (
              !Number.isNaN(parsed) &&
              parsed >= 0 &&
              parsed < TOTAL_PALETTES
            ) {
              palette = parsed;
            }
          } catch (e) {
            // ignore localStorage issues
          }

          return { mode, palette };
        }

        function updateColorsLinkLabel() {
          if (!colorsLink) return;
          const paletteLabels = ["Warm", "Seahawks", "70s", "Dark"];
          if (currentMode === "auto") {
            colorsLink.textContent = "Colors (Auto)";
            return;
          }

          const label = paletteLabels[currentPalette] || "Manual";
          colorsLink.textContent = "Colors (" + label + ")";
        }

        function getClockPalette() {
          const hour = new Date().getHours();
          return hour >= 19 || hour < 6 ? 3 : 0;
        }

        function applyAutoPalette() {
          applyPalette(getClockPalette());
        }

        function startAutoTimer() {
          if (autoTimerId) {
            clearInterval(autoTimerId);
          }
          autoTimerId = window.setInterval(function () {
            if (currentMode === "auto") {
              applyAutoPalette();
            }
          }, AUTO_CHECK_MS);
        }

        function stopAutoTimer() {
          if (!autoTimerId) return;
          clearInterval(autoTimerId);
          autoTimerId = null;
        }

        function setManualPalette(index) {
          stopAutoTimer();
          currentMode = "manual";
          applyPalette(index);
          savePalette(index);
          saveMode("manual");
          cycleIndex = Math.max(0, CYCLE.indexOf(index));
        }

        function setAutoMode() {
          currentMode = "auto";
          clearPalette();
          saveMode("auto");
          cycleIndex = CYCLE.indexOf("auto");
          applyAutoPalette();
          startAutoTimer();
        }

        document.addEventListener("DOMContentLoaded", function () {
          colorsLink = document.getElementById("colors-link");

          const stored = getStoredSettings();
          if (stored.mode === "manual" && stored.palette !== null) {
            setManualPalette(stored.palette);
            cycleIndex = Math.max(0, CYCLE.indexOf(stored.palette));
          } else {
            setAutoMode();
          }

          if (!colorsLink) return;

          colorsLink.addEventListener("click", function (event) {
            event.preventDefault();
            cycleIndex = (cycleIndex + 1) % CYCLE.length;
            const next = CYCLE[cycleIndex];
            if (next === "auto") {
              setAutoMode();
            } else {
              setManualPalette(next);
            }
          });
        });
      })();
    </script>
  </body>
</html>
